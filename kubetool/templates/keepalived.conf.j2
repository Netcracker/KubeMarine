## Copyright 2021 NetCracker Technology Corporation
##
## Licensed under the Apache License, Version 2.0 (the "License");
## you may not use this file except in compliance with the License.
## You may obtain a copy of the License at
##
##      http://www.apache.org/licenses/LICENSE-2.0
##
## Unless required by applicable law or agreed to in writing, software
## distributed under the License is distributed on an "AS IS" BASIS,
## WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
## See the License for the specific language governing permissions and
## limitations under the License.
##
vrrp_script script_{{ item['id'] }} {
    script       "/usr/local/bin/check_haproxy.sh"
    interval 2
    fall 2
    rise 2
}


vrrp_instance balancer_{{ item['id'] }} {
    state BACKUP
    interface {{ interface }}
    virtual_router_id {{ item['router_id'] }}
    priority {{ priority }}
    nopreempt
    virtual_ipaddress {
        {{ item['ip'] }} dev {{ interface }} label vip_{{ item['id'] }}
    }

    track_script {
        script_{{ item['id'] }}
    }

    authentication {
        auth_type PASS
        auth_pass {{ item['password'] }}
    }
{%- if peers | length > 0 %}
    unicast_src_ip {{ source }}
    unicast_peer {
{%- for ip in peers %}
        {{ ip }}
{%- endfor %}
    }
{%- endif %}
}
